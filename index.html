<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Ticket de Venta POS</title>
    <style>
        body { font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.4; color: #000; margin: 0; padding: 0; }
        .ticket { width: 210px; padding: 10px; }
        .header, .footer { text-align: center; }
        .header h2 { margin: 0; font-size: 14px; font-weight: bold; }
        .header p, .footer p, .info p { margin: 2px 0; }
        .item-list-header { display: flex; justify-content: space-between; font-weight: bold; border-bottom: 1px dashed #000; padding-bottom: 5px; margin-bottom: 5px; }
        .item { margin-bottom: 5px; }
        .item-line-2 { display: flex; justify-content: space-between; padding-left: 8px; }
        .totals { margin-top: 15px; }
        .totals p { display: flex; justify-content: space-between; margin: 2px 0; }
        .totals .total-final p { font-weight: bold; font-size: 13px; }
        hr { border: none; border-top: 1px dashed #000; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="ticket">
        <div class="header">
            <h2 id="nombre-empresa"></h2>
            <p id="direccion-empresa"></p>
            <p id="nit-empresa"></p>
        </div>
        <hr>
        <div class="info">
            <p>Ticket: <span id="ticket-id"></span></p>
            <p>Fecha: <span id="fecha"></span></p>
            <p>Cliente: <span id="cliente"></span></p>
        </div>
        <hr>
        <div class="item-list-header">
            <span>Producto</span>
            <span>Cant</span>
            <span>Total</span>
        </div>
        <div class="item-list" id="lista-items">
        </div>
        <hr>
        <div class="totals">
            <p><span>Total:</span> <span id="total_pos"></span></p>
            <p><span>Efectivo:</span> <span id="efectivo_recibido"></span></p>
            <div class="total-final">
                <p><span>Cambio:</span> <span id="devueltas"></span></p>
            </div>
        </div>
        <div class="footer">
            <hr>
            <p>¡Gracias por su compra!</p>
        </div>
    </div>

    <script>
        window.onload = function() {
            // --- INICIO DE LA MEJORA ---
            // 1. CREAMOS UN FORMATEADOR DE MONEDA PARA COLOMBIA (COP)
            const formatter = new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0 // Si no quieres decimales, usa 0. Si quieres dos, usa 2.
            });

            const params = new URLSearchParams(window.location.search);
            
            document.getElementById('nombre-empresa').innerText = params.get('empresa') || 'Emii Salud Farmacia';
            document.getElementById('direccion-empresa').innerText = params.get('direccion') || 'Tu Direccion, Cali';
            document.getElementById('nit-empresa').innerText = params.get('nit') || 'NIT: 900.123.456-7';
            document.getElementById('ticket-id').innerText = params.get('folio');
            document.getElementById('fecha').innerText = params.get('fecha');
            document.getElementById('cliente').innerText = params.get('cliente');

            // 2. APLICAMOS EL FORMATO A CADA VALOR NUMÉRICO
            document.getElementById('total_pos').innerText = formatter.format(params.get('total_pos') || 0);
            document.getElementById('efectivo_recibido').innerText = formatter.format(params.get('efectivo_recibido') || 0);
            document.getElementById('devueltas').innerText = formatter.format(params.get('devueltas') || 0);

            const cantidades = (params.get('cantidades') || '').split(',');
            const descripciones = (params.get('descripciones') || '').split(',');
            const precios = (params.get('precios') || '').split(',');
            const totalesLinea = (params.get('totales_linea') || '').split(',');
            
            const divListaItems = document.getElementById('lista-items');
            let itemsHTML = '';

            if (descripciones.length > 0 && descripciones[0]) {
                for (let i = 0; i < descripciones.length; i++) {
                    // 3. APLICAMOS EL FORMATO DENTRO DEL BUCLE DE PRODUCTOS
                    let item = `<div class="item">
                                    <div>${descripciones[i]}</div>
                                    <div class="item-line-2">
                                        <span>${cantidades[i]} x ${formatter.format(precios[i] || 0)}</span>
                                        <span>${formatter.format(totalesLinea[i] || 0)}</span>
                                    </div>
                                </div>`;
                    itemsHTML += item;
                }
            }
            divListaItems.innerHTML = itemsHTML;
        };
    </script>
</body>
</html>
